<!-- Firebase SDK -->
<script type="module">
  // Import Firebase (modular)
  import { initializeApp } from "https://www.gstatic.com/firebasejs/10.13.0/firebase-app.js";
  import { getStorage, ref, uploadBytes, getDownloadURL } from "https://www.gstatic.com/firebasejs/10.13.0/firebase-storage.js";
  import { getFirestore, collection, addDoc, getDocs, onSnapshot } from "https://www.gstatic.com/firebasejs/10.13.0/firebase-firestore.js";

  // ðŸ”¹ Your Firebase config (from console)
  const firebaseConfig = {
    apiKey: "AIzaSyC2ZMSgdR1JXIig4XqSUW_Fv_e1qguzoTg",
    authDomain: "meme-gallery-36502.firebaseapp.com",
    projectId: "meme-gallery-36502",
    storageBucket: "meme-gallery-36502.appspot.com",
    messagingSenderId: "260214027111",
    appId: "1:260214027111:web:ab08f479357ae55ffb35c2",
    measurementId: "G-XVD1331589"
  };

  // ðŸ”¹ Init Firebase
  const app = initializeApp(firebaseConfig);
  const storage = getStorage(app);
  const db = getFirestore(app);

  // ðŸ”¹ Form + Gallery
  const form = document.getElementById("memeForm");
  const gallery = document.getElementById("gallery");

  // ðŸ”¹ Listen for memes (real-time updates)
  onSnapshot(collection(db, "memes"), (snapshot) => {
    gallery.innerHTML = ""; // clear gallery
    snapshot.forEach((doc) => {
      const meme = doc.data();
      const memeCard = document.createElement("div");
      memeCard.className = "meme-card";
      memeCard.innerHTML = `
        <img src="${meme.url}" alt="Meme by ${meme.handle}" onerror="this.src='https://via.placeholder.com/180?text=Image+Not+Found'">
        <div class="author">meme by ${meme.handle}</div>
      `;
      gallery.prepend(memeCard);
    });
  });

  // ðŸ”¹ Upload Meme
  form.addEventListener("submit", async (e) => {
    e.preventDefault();
    const handle = document.getElementById("handle").value.trim();
    const file = document.getElementById("memeFile").files[0];
    const urlInput = document.getElementById("memeUrl").value.trim();

    if (!handle) return alert("Please enter your handle");

    let fileUrl = urlInput;

    // If file uploaded â†’ push to Firebase Storage
    if (file) {
      const fileRef = ref(storage, "memes/" + Date.now() + "-" + file.name);
      await uploadBytes(fileRef, file);
      fileUrl = await getDownloadURL(fileRef);
    }

    if (!fileUrl) return alert("Please upload a file or enter an image URL");

    // Save to Firestore
    await addDoc(collection(db, "memes"), {
      handle: handle,
      url: fileUrl,
      createdAt: Date.now()
    });

    form.reset();
  });
</script>
