<!-- Firebase SDK -->
<script type="module">
  // Import Firebase (modular style)
  import { initializeApp } from "https://www.gstatic.com/firebasejs/10.13.0/firebase-app.js";
  import { getStorage, ref, uploadBytes, getDownloadURL } from "https://www.gstatic.com/firebasejs/10.13.0/firebase-storage.js";
  import { getFirestore, collection, addDoc, getDocs } from "https://www.gstatic.com/firebasejs/10.13.0/firebase-firestore.js";

  // ðŸ”¹ Your Firebase config
  const firebaseConfig = {
    apiKey: "AIzaSyC2ZMSgdR1JXIig4XqSUW_Fv_e1qguzoTg",
    authDomain: "meme-gallery-36502.firebaseapp.com",
    projectId: "meme-gallery-36502",
    storageBucket: "meme-gallery-36502.appspot.com",   // âœ… FIXED
    messagingSenderId: "260214027111",
    appId: "1:260214027111:web:ab08f479357ae55ffb35c2",
    measurementId: "G-XVD1331589"
  };

  // Initialize Firebase
  const app = initializeApp(firebaseConfig);
  const storage = getStorage(app);
  const db = getFirestore(app);

  // Meme submission
  const form = document.getElementById('memeForm');
  const gallery = document.getElementById('gallery');

  async function loadMemes() {
    const snapshot = await getDocs(collection(db, "memes"));
    snapshot.forEach(doc => {
      const meme = doc.data();
      const memeCard = document.createElement('div');
      memeCard.className = 'meme-card';
      memeCard.innerHTML = `
        <img src="${meme.url}" alt="Meme by ${meme.handle}">
        <div class="author">meme by ${meme.handle}</div>
      `;
      gallery.prepend(memeCard);
    });
  }

  form.addEventListener('submit', async function(e) {
    e.preventDefault();
    const handle = document.getElementById('handle').value.trim();
    const file = document.getElementById('memeFile').files[0];

    if (!handle || !file) return alert("Please enter handle and choose a file");

    // Upload file to Firebase Storage
    const fileRef = ref(storage, 'memes/' + Date.now() + '-' + file.name);
    await uploadBytes(fileRef, file);
    const fileUrl = await getDownloadURL(fileRef);

    // Save meme data to Firestore
    await addDoc(collection(db, "memes"), {
      handle: handle,
      url: fileUrl
    });

    // Refresh gallery
    gallery.innerHTML = "";
    loadMemes();
    form.reset();
  });

  // Load memes on page load
  loadMemes();
</script>
